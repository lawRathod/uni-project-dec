# Real MIA Attack Implementation

## Overview
This project implements membership inference attacks (MIA) on graph neural networks using a realistic threat model where:
- **Target Model**: Trained on real-world graph data (train split)
- **Shadow Model**: Trained on synthetic data generated by DLGrapher
- **Attack Evaluation**: Performed on real non-training data to measure attack effectiveness

## Datasets and Classification Tasks
The attack will be performed on two datasets with the following classification targets:

### 1. Twitch Dataset
- **Graph type**: Social network of Twitch streamers
- **Node features**: 8 features (views, mature, life_time, created_at, updated_at, dead_account, language, affiliate)
- **Classification target**: `mature` (binary classification)
  - Predicts whether a streamer produces mature content
  - Balanced classes: ~53% non-mature, ~47% mature
  - Alternative targets: `affiliate` status or `dead_account` status

### 2. Event Dataset  
- **Graph type**: Event-based social network
- **Node features**: 5 features (locale, birthyear, gender, joinedAt, timezone)
- **Classification target**: `gender` (binary classification)
  - Predicts user gender (male/female)
  - Balanced classes: ~52% female, ~48% male
  - Alternative target: `locale` for 3-class classification

## Data Preparation
  1. The `rebMIGraph` source uses `torch_geometric.data.Data` objects from `torch_geometric.datasets`.
  2. Our dataset files need to be converted:
     - Real data: `*_train.pt` and `*_nontrain.pt` files contain real subgraphs
     - Synthetic data: `*_synth.pickle` files contain DLGrapher-generated graphs
     - Convert pandas DataFrames and NetworkX graphs to `torch_geometric.data.Data` format
     - Ensure node features, edge indices, and labels are properly formatted
  3. Data allocation:
     - **Target Model**: Uses real `*_train.pt` data
     - **Shadow Model**: Uses synthetic `*_synth.pickle` data
     - **Attack Testing**: Uses real `*_nontrain.pt` data

## Real MIA Attack Pipeline
1. **Dataset Loading & Preparation**
   - Load real training data (`*_train.pt`) for the target model
   - Load synthetic data (`*_synth.pickle`) for the shadow model
   - Load real non-training data (`*_nontrain.pt`) for attack evaluation
   - Convert all data to `torch_geometric.data.Data` format
   - Ensure consistent node features, edge indices, and labels across datasets

2. **Model Training Phase**
   - **Target Model**: 
     - Train on real-world training data (`*_train.pt`)
     - This simulates the victim's model trained on actual data
   - **Shadow Model**: 
     - Train on synthetic data (`*_synth.pickle`) 
     - This simulates the attacker's knowledge using DLGrapher-generated data
   - Both use same GNN architecture (GCN, SAGE, SGC, or GAT)

3. **Posterior Extraction**
   - For Target Model (on real data):
     - **Target In-Train**: Posteriors from real training nodes
     - **Target Out-Train**: Posteriors from real non-training nodes
   - For Shadow Model (on synthetic data):
     - **Shadow In-Train**: Posteriors from synthetic training nodes
     - **Shadow Out-Train**: Posteriors from synthetic test nodes

4. **Attack Model Training**
   - Train attack model using shadow model's posteriors:
     - **Positive samples**: Shadow In-Train posteriors (members)
     - **Negative samples**: Shadow Out-Train posteriors (non-members)
   - Attack model learns to distinguish members from non-members

5. **Attack Evaluation**
   - Test attack model on target model's posteriors:
     - Predict membership for Target In-Train (should predict "member")
     - Predict membership for Target Out-Train (should predict "non-member")
   - This measures how well synthetic-trained attack transfers to real data

6. **Metrics & Analysis**
   - Compute attack performance metrics:
     - Accuracy: Overall correctness of membership predictions
     - AUROC: Area under ROC curve for membership classification
     - Precision/Recall/F1: Detailed classification metrics
   - Compare attack effectiveness across:
     - Different GNN architectures (GCN, GAT, SAGE, SGC)
     - Different datasets (Twitch vs Event)

## Attack Setting: TSTS Only
This implementation focuses exclusively on the **TSTS (Train on Subgraph, Test on Subgraph)** setting because:
- DLGrapher generates collections of synthetic subgraphs (256 samples of 120 nodes each)
- We don't have a single large synthetic graph required for TSTF (Train on Subgraph, Test on Full graph)
- TSTS is more practical for our synthetic data format and aligns with how DLGrapher generates samples

## Key Modifications Needed
1. **Data Loading**: Modify to load different data sources for target/shadow models
2. **Training Pipeline**: Separate data paths for target (real) and shadow (synthetic)
3. **Evaluation**: Ensure attack is tested on real non-training data
4. **TSTS Implementation**: Adapt to handle multiple subgraphs from our dataset format

## Expected Outcomes
- Measure privacy leakage when attackers have access to synthetic data
- Evaluate how well DLGrapher-generated graphs approximate real data for attacks
- Identify which GNN architectures are more vulnerable to MIA
